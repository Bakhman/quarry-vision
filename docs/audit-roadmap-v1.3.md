# üß† QuarryVision ‚Äî Audit Roadmap (v1.3.x)

**–í–µ—Ç–∫–∞:** `audit/review-2025-10-29`  
**–¶–µ–ª—å:** –ó–∞–≤–µ—Ä—à–∏—Ç—å –∞—É–¥–∏—Ç –∏ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—é OCR/Detection –º–æ–¥—É–ª–µ–π, –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Ç–æ—á–∫—É `chk-ocr-stable`, –∑–∞—Ç–µ–º –ø–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ UI/Reports –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ —Ä–µ–ª–∏–∑–∞ v1.3.x.

---

## 1. –ö–æ–Ω—Ç–µ–∫—Å—Ç

–í –æ–∫—Ç—è–±—Ä–µ‚Äì–Ω–æ—è–±—Ä–µ 2025 –Ω–∞—á–∞—Ç **–∞—É–¥–∏—Ç –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã QuarryVision** –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã:
- OCR (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≥–æ—Å–Ω–æ–º–µ—Ä–æ–≤, –º–æ–¥—É–ª—å `core/ocr`)
- Detection (–∞–Ω–∞–ª–∏–∑ –∫–∞–¥—Ä–æ–≤, –º–æ–¥—É–ª—å `core/detection`)
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π (`Config.load()`, `application.yaml`)
- CI/CD (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ —Ä–µ–ª–∏–∑–∞)
- –Æ–Ω–∏—Ç- –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ (`src/test/java`)

–°–æ–∑–¥–∞–Ω –∫–∞—Ç–∞–ª–æ–≥ `_audit/` —Å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞–º–∏ –∞–Ω–∞–ª–∏–∑–∞ (`dependency-tree.txt`, `jdeps.txt`, `shaded-contents.txt`, `file-types.txt`).

---

## 2. –≠—Ç–∞–ø—ã –∞—É–¥–∏—Ç–∞

### ü©∫ –≠—Ç–∞–ø 1 ‚Äî OCR Accuracy & Normalization (–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è OCR)

**–¶–µ–ª—å:** –ø–æ–≤—ã—Å–∏—Ç—å —Ç–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –Ω–æ–º–µ—Ä–æ–≤ –∏ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –ª–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è.

**–ó–∞–¥–∞—á–∏:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å `OcrService.readBestToken()` –ø—Ä–∏ —Å–ª–∞–±–æ–º –∫–æ–Ω—Ç—Ä–∞—Å—Ç–µ.
2. –£—Ç–æ—á–Ω–∏—Ç—å –ø–æ—Ä–æ–≥–∏:  
   `qv.ocr.minContrast`, `fillMin`, `fillMax`.
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å fallback-–≤–µ—Ç–∫–∏ (`adaptiveThreshold`, `Otsu`) –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã PSM/OEM.
4. –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É OCR-–ø—É—Ç–∞–Ω–∏—Ü (O/0/A, P/–†, B/–í, C/–°, E/–ï, M/–ú).
5. –ó–∞–≤–µ—Ä—à–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –Ω–æ–º–µ—Ä–æ–≤ (`PlateNormalize.normalizePlate()`).
6. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç-–∫–µ–π—Å—ã —Å —Ä–∞–∑–º—ã—Ç—ã–º–∏ –Ω–æ–º–µ—Ä–∞–º–∏ –≤ `testdata/ocr/plates/`.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**  
‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã `OcrServiceTest` –∏ `PlateNormalizeTest` –∑–µ–ª—ë–Ω—ã–µ, –≤–∫–ª—é—á–∞—è –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã.

---

### üîç –≠—Ç–∞–ø 2 ‚Äî ROI Scan Validation (Smoke ROI)

**–¶–µ–ª—å:** —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É `BucketDetector.tryOcrPlate()` –ø—Ä–∏ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö –≤–∏–¥–µ–æ (16:9, 4:3).

**–ó–∞–¥–∞—á–∏:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–µ—Ç–∫–∏ ROI (`fy`, `fh`, `fx`, `fw`).
2. –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é ROI –ø–æ –∫–æ–Ω—Ç—Ä–∞—Å—Ç—É –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏ (`fill`).
3. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç ROI –∏ –∏—Ö –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞.
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—Ä–æ—Å—Å-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å OpenCV 4.10 (JavaCPP).
5. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî –≤–∫–ª—é—á–∏—Ç—å —Ñ–ª–∞–≥ `-Dqv.ocr.debugRoi=true` (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ROI-–∫–∞—Ä—Ç–∏–Ω–æ–∫).

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**  
‚úÖ –¢–µ—Å—Ç `RoiScanSmokeTest` –ø—Ä–æ—Ö–æ–¥–∏—Ç –Ω–∞ ‚â•90 % –≤—ã–±–æ—Ä–æ–∫.

---

### üß± –≠—Ç–∞–ø 3 ‚Äî –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Ñ–∏–∫—Å–∞—Ü–∏—è checkpoint

**–¶–µ–ª—å:** –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ OCR –∏ Detection –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ UI/Reports.

**–ó–∞–¥–∞—á–∏:**
1. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ —Ç–µ—Å—Ç—ã (`mvn test`) –∑–µ–ª—ë–Ω—ã–µ.
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–±–æ—Ä–∫—É –±–µ–∑ —Ç–µ—Å—Ç–æ–≤:
   ```bash
   mvn -q -DskipTests clean package
   ```   
3. –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç _audit/chk-ocr-stable.txt —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏.  
4. –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:
  ```
    git add .
       git commit -m "audit: finalize OCR & detection (chk-ocr-stable)"
       git tag -a chk-ocr-stable -m "OCR stable checkpoint"
  ```   
5. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ–∞–∑–µ Reports/UI (v1.3.x).

### üßæ –≠—Ç–∞–ø 4 ‚Äî Reports / Queue / UI Integration

**–¶–µ–ª—å:** —Å–≤—è–∑–∞—Ç—å OCR-—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –∏ –æ—Ç—á—ë—Ç–∞–º–∏.

**–ó–∞–¥–∞—á–∏:**
1. *Reports:* –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–æ–±—ã—Ç–∏—è (–≤–∏–¥–µ–æ, –∫–∞–º–µ—Ä–∞, –≤—Ä–µ–º—è, —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä). 
2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å `Pg.listDetections()` –∏ `Pg.listEvents()` –∫ –≤–∫–ª–∞–¥–∫–µ Reports. 
3. –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –ø–µ—Ä–∏–æ–¥—É –∏ –∫–∞–º–µ—Ä–µ. 
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç–∫—Å–ø–æ—Ä—Ç CSV (`reports/export.csv`). 
5. *Queue:* –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ, –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å ‚ÄúPending / Processing / Done‚Äù.

## 3. –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏

| –≠—Ç–∞–ø                   | Tag            | –¶–µ–ª—å                         | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|------------------------|----------------|------------------------------|-----------|
| OCR Accuracy           | chk-ocr-stable | OCR —Å—Ç–∞–±–∏–ª–µ–Ω, —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ  | ‚úÖ         |
| ROI Validation         | chk-roi-ok     | ROI —Å–∫–∞–Ω —Å—Ç–∞–±–∏–ª–µ–Ω            | ‚è≥         |
| UI Reports Integration | chk-ui-reports | –û—Ç—á—ë—Ç—ã –∏ UI –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã    | üîú        |
| Release                | v1.3.0         | –ì–æ—Ç–æ–≤–∞—è —Å–±–æ—Ä–∫–∞ —Å OCR/Reports | üöÄ        |

## 4. –°–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –º–æ–º–µ–Ω—Ç –∞—É–¥–∏—Ç–∞

‚úÖ OCR-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞, —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –Ω–∞ —á—ë—Ç–∫–∏—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö.  
‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è YAML —Ä–∞—Å—à–∏—Ä–µ–Ω–∞ (COUNTER, PLATE, DISPLAY).  
‚úÖ Boot.java –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç OCR –ø–æ -Dqv.ocr.init.  
‚úÖ Pg.java –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ.  
‚úÖ PlateNormalizeTest / OcrServiceTest –∑–µ–ª—ë–Ω—ã–µ.  
üöß RoiScanSmokeTest —Ç—Ä–µ–±—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ ROI.  
üöß OCR –¥–ª—è ‚Äú—à—É–º–Ω—ã—Ö‚Äù –Ω–æ–º–µ—Ä–æ–≤ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏.  
üöß –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ V6__detections_stats.sql.  
üîú –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø ‚Äî —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è OCR ‚Üí —Ñ–∏–∫—Å–∞—Ü–∏—è checkpoint ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ UI/Reports.  

## 5. –ü—Ä–∏–º–µ—á–∞–Ω–∏—è  
* –í —Ä–µ–ª–∏–∑–Ω–æ–π —Å–±–æ—Ä–∫–µ release.yaml –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è ZIP-–¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤:
  ```
  app/quarry-vision.jar
  config/application.yaml
  app/tessdata/
  jre/
  run.bat
  ```  
* tessdata –≤–∫–ª—é—á—ë–Ω –≤ —Å–æ—Å—Ç–∞–≤ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ runtime —á–µ—Ä–µ–∑ fallback-–º–µ—Ö–∞–Ω–∏–∫—É:  
**1.**`-Dqv.ocr.datapath=...`    
**2.** `./tessdata`   
**3.** `classpath:/tessdata`     

* –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ OCR –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
```bash
mvn -Dtest=OcrServiceTest test
mvn -Dtest=RoiScanSmokeTest test
```

–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 2025-11-07  
–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π: Bakhman  
–†–µ–¥–∞–∫—Ç–æ—Ä: ChatGPT (DevMate)  
–í–µ—Ä—Å–∏—è: v1.3-audit-plan  

---
